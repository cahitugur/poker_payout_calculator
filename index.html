<!--
  Copyright (c) 2025 Cahit Ugur
  SPDX-License-Identifier: MIT
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poker Payout Calculator</title>
  <!-- Favicon: green spade icon (SVG for tabs); PNG touch icon will be generated at runtime -->
  <link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" ry="12" fill="%230b1020"/><text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-size="44" font-family="system-ui,Segoe UI,Roboto,Helvetica,Arial" fill="%2310b981">â™ </text></svg>'/>
  <meta name="theme-color" content="#0b1020" />
  <!-- Single-file shortcut support (best-effort): iOS/Android home-screen shortcuts look for apple-touch-icon -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="stylesheet" href="shared-styles.css" />
  <style>
    /* Page-specific styles for index.html */
    col.col-name { width: auto; }
    col.col-in, col.col-out, col.col-payout { width: 10ch; min-width: 10ch; }
    col.col-step { width: 24px; min-width: 24px; }
    /* Center-align numeric columns: In is third column, Out fifth, Payout sixth */
    thead th:nth-child(3), thead th:nth-child(5), thead th:nth-child(6) { text-align: center; }
    tbody td:nth-child(3), tbody td:nth-child(5) { text-align: center; }
    /* Payout column (6th) - values aligned right */
    tbody td:nth-child(6) { text-align: right; }
    tfoot th { text-align: right; }

    .name-input { width: calc(100%); }
    .name-cell-wrapper { display: flex; align-items: center; gap: 8px; }
    .name-cell-wrapper .name-input { flex: 1; }
    .name-cell-wrapper input[type="checkbox"] { flex-shrink: 0; cursor: pointer; accent-color: var(--ok); }
    .name-cell-wrapper input[type="checkbox"]:not(:checked) { opacity: 0.5; }
    .name-cell-wrapper.hidden-checkboxes input[type="checkbox"] { display: none; }
    .delete-btn { flex-shrink: 0; cursor: pointer; background: none; border: none; font-size: 18px; padding: 0; color: var(--warn); opacity: 0.6; transition: opacity 0.2s; }
    .delete-btn:hover { opacity: 1; }
    .delete-btn:active { transform: scale(0.9); }
    .name-cell-wrapper.hidden-delete-btns .delete-btn { display: none; }
    .name-header { display: flex; align-items: center; justify-content: space-between; }
    .name-header input[type="checkbox"] { cursor: pointer; margin-left: 8px; }
    .player-chip { display: inline-block; padding: 6px 12px; background: rgba(16, 185, 129, 0.15); border: 1px solid var(--ok); border-radius: 6px; color: var(--text); cursor: pointer; font-size: 13px; transition: all 0.2s; }
    .player-chip:hover { background: rgba(16, 185, 129, 0.25); transform: translateY(-1px); }
    .player-chip:active { transform: translateY(0); }
    .num-input { padding: 6px 4px; }
    .num-input.zero-value { color: var(--muted) !important; }

    /* Step buttons live in their own small columns; align right and middle */
    .step-cell { vertical-align: middle; padding-left: 0 !important; padding-right: 0 !important; }
    .step-cell.minus-cell { text-align: right; }
    .step-cell.plus-cell { text-align: left; }
    .step-btn {
      display: inline-flex; align-items: center; justify-content: center;
      width: 25px; height: 25px; padding: 0px; border-radius: 50%; border: 1px solid var(--outline);
      cursor: pointer; font-weight: 800; color: white; font-size: 12px; background: transparent;
    }
    /* push minus rightward and plus leftward by adding external margins */
    .step-btn.minus { background: var(--warn); border-color: rgba(0,0,0,0.2); margin-right: 0px; }
    .step-btn.plus { background: var(--ok); border-color: rgba(0,0,0,0.2); margin-left: 0px; }
    .step-btn:active { transform: translateY(1px); }

    /* Hamburger menu */
    .menu-btn {
      background: none; border: none; cursor: pointer; font-size: 24px; color: var(--text);
      padding: 6px; display: flex; flex-direction: column; gap: 5px; align-items: center; justify-content: center;
    }
    .menu-btn span { width: 24px; height: 2px; background: var(--text); border-radius: 1px; display: block; }
    .menu-dropdown { position: absolute; top: 100%; left: 0; background: #0b1020; border: 1px solid var(--outline); border-radius: 6px;
      min-width: 200px; display: none; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    .menu-dropdown.active { display: block; }
    .menu-dropdown a { display: block; padding: 12px 16px; color: var(--accent); text-decoration: none; border-bottom: 1px solid var(--outline);
      font-weight: 500; transition: background 0.2s; }
    .menu-dropdown a:last-child { border-bottom: none; }
    .menu-dropdown a:hover { background: #0e1530; }

    /* Mobile-friendly responsive design */
    @media (max-width: 768px) {
      col.col-name { width: 35%; }
      col.col-in, col.col-out, col.col-payout { width: 10ch; min-width: 10ch; }
      col.col-step { width: 22px; min-width: 22px; }
      thead th, tbody td, tfoot th { padding: 6px 4px; }

      .step-btn { width: 20px; height: 20px; font-size: 13px; }
      .step-btn.minus { margin-right: 0px; }
      .step-btn.plus { margin-left: 0px; }
    }

    @media (max-width: 480px) {
      col.col-name { width: 40%; }
      col.col-in, col.col-out, col.col-payout { width: 8ch; min-width: 8ch; }
      col.col-step { width: 22px; min-width: 22px; }
      thead th, tbody td, tfoot th { padding: 5px 3px; }

      .step-btn { width: 18px; height: 18px; font-size: 12px; }
      .step-btn.minus { margin-right: 0px; }
      .step-btn.plus { margin-left: 0px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Poker Payout Calculator</h1>
    <div class="card">
      <div class="toolbar">
        <button id="menuBtn" class="menu-btn" aria-label="Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div id="menuDropdown" class="menu-dropdown">
          <a href="index.html">Poker Payout Calculator</a>
          <a href="side-pot-calculator.html">Side Pot Calculator</a>
        </div>
        <span aria-hidden="true" title="Poker" style="display:inline-flex;align-items:center;gap:8px">
          <svg width="22" height="22" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img">
            <title>Spade</title>
            <path fill="#10b981" d="M32 6C20 18 8 26 8 36c0 6 5 11 11 11 4 0 8-2 10-5-1 5-3 9-8 12h22c-5-3-7-7-8-12 2 3 6 5 10 5 6 0 11-5 11-11 0-10-12-18-24-30z"/>
          </svg>
        </span>
        <div id="balanceStatus" class="status warn" aria-live="polite">
          <span class="dot"></span>
          <span class="status-text">Unbalanced</span>
        </div>
        <span class="spacer" style="flex: 1;"></span>
      </div>

      <div class="table-wrap">
        <form id="calcForm">
          <table>
            <colgroup>
              <col class="col-name">
              <col class="col-step">
              <col class="col-in">
              <col class="col-step">
              <col class="col-out">
              <col class="col-payout">
            </colgroup>
            <thead>
              <tr>
                <th class="controls-cell" colspan="6">
                  <div class="controls">
                    <button id="addRowBtn" class="btn" type="button">âž• Add</button>
                    <button id="deleteRowBtn" class="btn" type="button">âž– Delete</button>
                    <button id="clearBtn" class="btn" type="button">ðŸ§¹ Clear</button>
                    <div class="spacer"></div>
                    <div class="buyin-container">
                      <label class="buyin-label" for="buyInInput">Buy-In</label>
                      <input id="buyInInput" class="buyin-input num-input" type="text" inputmode="numeric" value="30" />
                    </div>
                  </div>
                </th>
              </tr>
              <tr>
                <th>Name</th>
                <th aria-label="decrement"></th>
                <th>In</th>
                <th aria-label="increment"></th>
                <th>Out</th>
                <th>Payout</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>

            <tfoot>
              <tr>
                <th>Total</th>
                <th></th>
                <th id="totalIn" class="payout">0.00</th>
                <th></th>
                <th id="totalOut" class="payout">0.00</th>
                <th id="totalPayout" class="payout">0.00</th>
              </tr>
            </tfoot>
          </table>
        </form>
      </div>

      <div style="margin-top: 16px; text-align: center;">
        <button id="usualSuspectsBtn" class="btn" type="button" style="padding: 8px 16px;">ðŸ‘¥ Usual Suspects</button>
        <button id="settleBtn" class="btn" type="button" style="padding: 8px 16px; margin-left: 8px;">âœ” Settle</button>
        <div id="usualSuspectsList" style="margin-top: 12px; display: none; flex-wrap: wrap; gap: 8px; justify-content: center;"></div>
      </div>

    </div>
  </div>

  <footer></footer>

  <script src="shared-data.js"></script>
  <script>
    (function(){
      const MAX_ROWS = 32;
      const STORAGE_KEY = 'poker-payout:v1';

      const rowsTbody = document.getElementById('rows');
      const addRowBtn = document.getElementById('addRowBtn');
      const deleteRowBtn = document.getElementById('deleteRowBtn');
      const clearBtn = document.getElementById('clearBtn');
      const usualSuspectsBtn = document.getElementById('usualSuspectsBtn');
      const buyInInput = document.getElementById('buyInInput');
  const totalInEl = document.getElementById('totalIn');
      const totalOutEl = document.getElementById('totalOut');
      const totalPayoutEl = document.getElementById('totalPayout');
      const statusEl = document.getElementById('balanceStatus');
      const statusText = statusEl.querySelector('.status-text');
      const capNote = document.getElementById('rowCapNote');

      // State variables for mode toggling
      let deleteButtonMode = false; // Default to hidden
      let checkboxesVisible = false; // Default to hidden

      function fmt(n){ return (Math.round(n*100)/100).toFixed(2).replace('-0.00','0.00'); }
      function fmtInt(n){ return Math.round(n).toString().replace('-0','0'); }
      function parseNum(v){
        if(!v) return 0;
        let str = String(v).trim();
        if(str==='') return 0;
        if(str.includes(',') && str.includes('.')){
          if(str.lastIndexOf(',')>str.lastIndexOf('.')) str=str.replace(/\./g,'').replace(',', '.');
          else str=str.replace(/,/g,'');
        } else if(str.includes(',')) str=str.replace(/\./g,'').replace(',', '.');
        const num=parseFloat(str.replace(/[^0-9+\-\.]/g,''));
        return Number.isFinite(num)?num:0;
      }

      function validateInput(i){
        const raw=i.value.trim();
        if(raw===''){i.classList.remove('invalid');return;}
        const ok=!isNaN(parseNum(raw));
        i.classList.toggle('invalid',!ok);
      }

      // Return buy-in string if valid number, otherwise null
      function getBuyInVal(){
        if(!buyInInput) return null;
        const raw = String(buyInInput.value).trim();
        if(raw==='') return null;
        const n = parseNum(raw);
        return Number.isFinite(n)? raw : null;
      }

      function createCellWithInput(cls,ph,opts={},def=''){
        const td=document.createElement('td');
        const inp=document.createElement('input');
        inp.type='text';inp.className=cls;inp.placeholder=ph;inp.autocomplete='off';inp.spellcheck=false;
        if(opts.inputmode) inp.setAttribute('inputmode',opts.inputmode);
        if(opts.enterkeyhint) inp.setAttribute('enterkeyhint',opts.enterkeyhint);
        if(opts.pattern) inp.setAttribute('pattern',opts.pattern);
        if(def!=='') inp.value=def;
        td.appendChild(inp);return {td,inp};
      }

      function attachFieldHandlers(nameInp, inInp, outInp){
        const updateZeroClass = () => {
          const inVal = parseNum(inInp.value);
          const outVal = parseNum(outInp.value);
          inInp.classList.toggle('zero-value', inVal === 0);
          outInp.classList.toggle('zero-value', outVal === 0);
        };
        const onChange=()=>{ validateInput(inInp); validateInput(outInp); updateZeroClass(); recalc(); save(); };
        inInp.addEventListener('input', onChange);
        outInp.addEventListener('input', onChange);
        inInp.addEventListener('blur', updateZeroClass);
        outInp.addEventListener('blur', updateZeroClass);
        updateZeroClass(); // Initial check
        for(const el of [nameInp,inInp,outInp]){
          el.addEventListener('input', save);
          el.addEventListener('click', ()=>{ el.select(); });
        }
      }

      function createRow(values){
        const tr=document.createElement('tr');
        const nameDef = values?.name ?? '';
        // Default 'In' uses validated Buy-In value when available
        const inDef   = values?.in ?? (getBuyInVal() ?? '30');
        const outDef  = values?.out ?? '';
        const settledDef = values?.settled ?? false;

  // Name cell with checkbox and delete button
  const nameCell=createCellWithInput('name-input','Player',{inputmode:'text',enterkeyhint:'next'}, nameDef);
  const wrapper = document.createElement('div');
  // Set initial classes based on current mode
  let wrapperClasses = 'name-cell-wrapper';
  if(deleteButtonMode){
    wrapperClasses += ' hidden-checkboxes';
  } else {
    wrapperClasses += ' hidden-delete-btns';
    if(!checkboxesVisible){
      wrapperClasses += ' hidden-checkboxes';
    }
  }
  wrapper.className = wrapperClasses;
  wrapper.appendChild(nameCell.inp);
  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.checked = settledDef;
  checkbox.title = 'Settled';
  checkbox.addEventListener('change', save);
  wrapper.appendChild(checkbox);
  const deleteBtn = document.createElement('button');
  deleteBtn.type = 'button';
  deleteBtn.className = 'delete-btn';
  deleteBtn.textContent = 'ðŸ—‘';
  deleteBtn.title = 'Delete player';
  deleteBtn.setAttribute('aria-label', 'Delete player');
  deleteBtn.addEventListener('click', (e)=>{
    e.preventDefault();
    const playerName = tr._refs.name.value.trim();
    const index = Array.from(rowsTbody.children).indexOf(tr);
    if(index !== -1){
      rowsTbody.removeChild(tr);
      // Add player back to available suspects only if they're in the original hardcoded list
      if(playerName && USUAL_SUSPECTS.includes(playerName) && !availableSuspects.includes(playerName)){
        availableSuspects.push(playerName);
        availableSuspects.sort(); // Keep list alphabetically sorted
        // Re-render the suspects list if it's visible
        if(suspectsList && suspectsList.style.display === 'flex'){
          const renderFn = window.renderSuspectsList;
          if(renderFn) renderFn();
        }
      }
      updateCapNote(); recalc(); save();
    }
  });
  wrapper.appendChild(deleteBtn);
  nameCell.td.innerHTML = '';
  nameCell.td.appendChild(wrapper);
  tr.appendChild(nameCell.td);

  // Minus step cell
  const stepMinusTd = document.createElement('td'); stepMinusTd.className='step-cell minus-cell';
  const minusBtn = document.createElement('button'); minusBtn.type='button'; minusBtn.className='step-btn minus'; minusBtn.textContent='âˆ’';
  minusBtn.title = 'Subtract buy-in'; minusBtn.setAttribute('aria-label', 'Subtract buy-in');
  stepMinusTd.appendChild(minusBtn); tr.appendChild(stepMinusTd);

  // In cell
  const inCell=createCellWithInput('num-input','0',{inputmode:'numeric',enterkeyhint:'next',pattern:"[0-9\\- ]*"}, inDef);
  tr.appendChild(inCell.td);

  // Plus step cell
  const stepPlusTd = document.createElement('td'); stepPlusTd.className='step-cell plus-cell';
  const plusBtn = document.createElement('button'); plusBtn.type='button'; plusBtn.className='step-btn plus'; plusBtn.textContent='+';
  plusBtn.title = 'Add buy-in'; plusBtn.setAttribute('aria-label', 'Add buy-in');
  stepPlusTd.appendChild(plusBtn); tr.appendChild(stepPlusTd);

  // Out cell
  const outCell=createCellWithInput('num-input','0.00',{inputmode:'decimal',enterkeyhint:'next',pattern:"[0-9.,\\- ]*"}, outDef);
  tr.appendChild(outCell.td);
        const payoutTd=document.createElement('td'); payoutTd.className='payout'; payoutTd.textContent='0.00'; tr.appendChild(payoutTd);

        // attach handlers
        attachFieldHandlers(nameCell.inp, inCell.inp, outCell.inp);

        // step button handlers operate on the In input
        function adjustIn(delta){
          const buy = getBuyInVal();
          const buyNum = buy !== null ? parseNum(buy) : null;
          if(buyNum===null) return; // invalid buy-in
          const cur = parseNum(inCell.inp.value);
          let newVal = cur + delta * buyNum;
          if(newVal < buyNum) newVal = buyNum;
          inCell.inp.value = fmtInt(newVal);
          validateInput(inCell.inp);
          recalc(); save();
        }
        minusBtn.addEventListener('click', ()=> adjustIn(-1));
        plusBtn.addEventListener('click', ()=> adjustIn(1));

        tr._refs={checkbox:checkbox,name:nameCell.inp,in:inCell.inp,out:outCell.inp,payout:payoutTd};
        return tr;
      }

      function updateCapNote(){
        const count=rowsTbody.children.length;
        if(capNote) capNote.textContent=`${count} / ${MAX_ROWS} rows`;
        addRowBtn.disabled=count>=MAX_ROWS;
        deleteRowBtn.disabled=count<=0;
      }

      function addRow(values){
        if(rowsTbody.children.length>=MAX_ROWS) return null;
        const tr=createRow(values); rowsTbody.appendChild(tr);
        updateCapNote(); recalc(); save(); return tr;
      }

      function deleteRow(){
        if(rowsTbody.children.length>0){
          rowsTbody.removeChild(rowsTbody.lastElementChild);
          updateCapNote(); recalc(); save();
        }
      }

      function clearTable(){
        rowsTbody.innerHTML='';
        for(let i=0;i<2;i++) addRow();
        // Reset available suspects list
        availableSuspects = [...USUAL_SUSPECTS];
        if(suspectsList && suspectsList.style.display === 'flex'){
          const renderFn = window.renderSuspectsList;
          if(renderFn) renderFn();
        }
        recalc();
        localStorage.removeItem(STORAGE_KEY);
      }

      function serialize(){
        const rows=[];
        for(const tr of rowsTbody.children){
          rows.push({
            name: tr._refs.name.value,
            in: tr._refs.in.value,
            out: tr._refs.out.value,
            settled: tr._refs.checkbox.checked
          });
        }
        return { rows };
      }

      function save(){
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(Object.assign({}, serialize(), { buyIn: buyInInput ? buyInInput.value : undefined }))); }
        catch(e){ /* storage might be disabled */ }
      }

      function restore(){
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if(!raw) return false;
          const data = JSON.parse(raw);
          if(!data || !Array.isArray(data.rows)) return false;
          rowsTbody.innerHTML='';
          // restore buy-in if present
          if(buyInInput && data.buyIn) buyInInput.value = data.buyIn;
          for(const r of data.rows){ addRow({ name: r.name ?? '', in: r.in ?? '', out: r.out ?? '', settled: r.settled ?? false }); }
          recalc();
          return true;
        } catch(e){ return false; }
      }

      function recalc(){
        let totalIn=0,totalOut=0;
        const buyRaw = getBuyInVal();
        const buyNum = buyRaw !== null ? parseNum(buyRaw) : null;
        for(const tr of rowsTbody.children){
          let inv=parseNum(tr._refs.in.value);
          let outv=parseNum(tr._refs.out.value);
          // enforce minima: Out >= 0
          if(outv < 0){ outv = 0; tr._refs.out.value = fmt(outv); validateInput(tr._refs.out); }
          const payout = outv - inv; tr._refs.payout.textContent = fmt(payout);
          totalIn += inv; totalOut += outv;
        }
        totalInEl.textContent=fmtInt(totalIn); totalOutEl.textContent=fmt(totalOut); totalPayoutEl.textContent=fmt(totalOut-totalIn);
        const balanced=Math.abs(Math.round((totalOut-totalIn)*100))===0;
        statusEl.classList.toggle('ok',balanced); statusEl.classList.toggle('warn',!balanced);
        statusText.textContent=balanced?'Balanced':'Unbalanced';
      }

      // init
      if(!restore()){
        for(let i=0;i<2;i++) addRow();
      }
      addRowBtn.addEventListener('click',()=>{const tr=addRow();});
      deleteRowBtn.style.opacity = '1'; // Full brightness to match Add button
      deleteRowBtn.addEventListener('click',()=>{
        deleteButtonMode = !deleteButtonMode;
        for(const tr of rowsTbody.children){
          const wrapper = tr.querySelector('.name-cell-wrapper');
          if(wrapper){
            if(deleteButtonMode){
              wrapper.classList.remove('hidden-delete-btns');
              wrapper.classList.add('hidden-checkboxes');
            } else {
              wrapper.classList.add('hidden-delete-btns');
              // When exiting delete mode, restore checkbox visibility based on checkboxesVisible flag
              if(checkboxesVisible){
                wrapper.classList.remove('hidden-checkboxes');
              } else {
                wrapper.classList.add('hidden-checkboxes');
              }
            }
          }
        }
        // Update button style to show active state (but never gray out)
        if(deleteButtonMode){
          deleteRowBtn.style.opacity = '1';
          settleBtn.style.opacity = '1';
          checkboxesVisible = false;
        }
      });
      clearBtn.addEventListener('click',clearTable);

      let availableSuspects = [...USUAL_SUSPECTS];
      const suspectsList = document.getElementById('usualSuspectsList');

      if(usualSuspectsBtn){
        function renderSuspectsList(){
          if(!suspectsList) return;
          suspectsList.innerHTML = '';
          for(const name of availableSuspects){
            const chip = document.createElement('span');
            chip.className = 'player-chip';
            chip.textContent = name;
            chip.addEventListener('click', ()=>{
              // Check for empty row first
              let emptyRow = null;
              for(const tr of rowsTbody.children){
                if(!tr._refs.name.value.trim()){
                  emptyRow = tr;
                  break;
                }
              }

              if(emptyRow){
                // Fill empty row
                emptyRow._refs.name.value = name;
              } else {
                // Add new row at bottom
                const tr = addRow({name, in: '', out: ''});
              }

              // Remove from available list
              availableSuspects = availableSuspects.filter(n => n !== name);
              renderSuspectsList();
              recalc();
              save();
            });
            suspectsList.appendChild(chip);
          }
        }

        // Make renderSuspectsList accessible to clearTable
        window.renderSuspectsList = renderSuspectsList;

        usualSuspectsBtn.addEventListener('click', ()=>{
          if(suspectsList.style.display === 'none' || suspectsList.style.display === ''){
            suspectsList.style.display = 'flex';
            renderSuspectsList();
          } else {
            suspectsList.style.display = 'none';
          }
        });
      }

      if(buyInInput){
        buyInInput.addEventListener('input', ()=>{
          // validate buy-in
          validateInput(buyInInput);
          const val = getBuyInVal();
          // if valid, override all 'In' inputs to this value (per user's request)
          for(const tr of rowsTbody.children){
            try{
              const inEl = tr._refs && tr._refs.in;
              if(inEl){ inEl.value = val!==null ? fmtInt(parseNum(val)) : inEl.value; validateInput(inEl); }
            }catch(e){}
          }
          save(); recalc();
        });
        buyInInput.addEventListener('click', ()=>{ buyInInput.select(); });
      }

      // Settle button handler
      const settleBtn = document.getElementById('settleBtn');

      if(settleBtn){
        // Set initial button opacity to match Add button brightness
        settleBtn.style.opacity = '1';

        settleBtn.addEventListener('click', ()=>{
          if(deleteButtonMode){
            // If in delete mode, turn off delete mode first
            deleteButtonMode = false;
            for(const tr of rowsTbody.children){
              const wrapper = tr.querySelector('.name-cell-wrapper');
              if(wrapper){
                wrapper.classList.add('hidden-delete-btns');
              }
            }
            deleteRowBtn.style.opacity = '1';
          }
          checkboxesVisible = !checkboxesVisible;
          for(const tr of rowsTbody.children){
            const wrapper = tr.querySelector('.name-cell-wrapper');
            if(wrapper){
              if(checkboxesVisible){
                wrapper.classList.remove('hidden-checkboxes');
              } else {
                wrapper.classList.add('hidden-checkboxes');
              }
            }
          }
          // Update button style (but never gray out)
          settleBtn.style.opacity = '1';
        });
      }

      // Transfer player names when navigating to SPC via menu
      const spcMenuLink = document.querySelector('#menuDropdown a[href="side-pot-calculator.html"]');
      if(spcMenuLink){
        spcMenuLink.addEventListener('click', (e)=>{
          e.preventDefault();
          const names = [];
          for(const tr of rowsTbody.children){
            const name = tr._refs.name.value.trim();
            if(name) names.push(name);
          }
          const params = new URLSearchParams();
          if(names.length > 0) params.set('names', names.join(','));
          window.location.href = 'side-pot-calculator.html' + (params.toString() ? '?' + params.toString() : '');
        });
      }

      // Menu button handler
      const menuBtn = document.getElementById('menuBtn');
      const menuDropdown = document.getElementById('menuDropdown');
      if(menuBtn && menuDropdown){
        menuBtn.addEventListener('click', (e)=>{
          e.stopPropagation();
          menuDropdown.classList.toggle('active');
        });
        document.addEventListener('click', ()=>{
          menuDropdown.classList.remove('active');
        });
      }

      recalc();
    })();
  </script>
  <script src="shared-icons.js"></script>
</body>
</html>
